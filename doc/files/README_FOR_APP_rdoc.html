<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>File: README_FOR_APP.rdoc</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
    <table border='0' cellpadding='0' cellspacing='0' width="100%" class='banner'>
    <tr><td>
    <table width="100%" border='0' cellpadding='0' cellspacing='0'><tr>
      <td class="file-title" colspan="2"><span class="file-title-prefix">File</span><br />README_FOR_APP.rdoc</td>
      <td align="right">
        <table border='0' cellspacing="0" cellpadding="2">
          <tr>
            <td>Path:</td>
            <td>README_FOR_APP.rdoc            </td>
          </tr>
          <tr>
            <td>Modified:</td>
            <td>2012-07-01 22:23:40 -0600</td>
          </tr>
        </table>
      </td></tr>
    </table>
  </td></tr>
</table><br />
  <div id="bodyContent">
  <div id="content">
  <div class="description">
<h1 id="label-Tour+Scheduler"><a href="../classes/Tour.html">Tour</a> Scheduler</h1>

<h2 id="label-Task+Description">Task Description</h2>

<p>Create this simple Rails application (sinatra or any other rack framework
is also acceptable). Write functional code in the most efficient manner and
with your best workmanship. Do not worry about how long this takes you;
focus on showing us clear logic, best practices and your
methodologies/design patterns – your choice of these is part of the review
process. Don’t try to future-proof the app, either. We’re fans of simple,
concise code. As always, security is an issue. You’re building a website
that has a “tour scheduling” feature:</p>
<ol><li>
<p>User requests a tour, and provides their email address. We send an
activation email.</p>
</li><li>
<p>User clinks link in activation email, which takes them to a form where they
enter their first name, last name and phone number.  When submitting that,
they’re shown another form.</p>
</li><li>
<p>This form asks for some extra details: preferred tour date, additional
questions (nothing fancy, a basic string will work), and asks them to
choose a list of amenities they’re interested in (use this list for
demonstration purposes: “pool”, “rec room”, “movie theater”, “on site
doctor”, “time machine”).</p>
</li><li>
<p>Once this last form is submitted they should be presented with a success
screen and a confirmation email should be sent to the user.  A “New <a
href="../classes/Tour.html">Tour</a> Scheduled” email should be delivered
to tours@example.com with the users information, their requested tour
information and the IP address used to request the tour.</p>
</li><li>
<p>If the user clicks the same link again, they should be presented with their
already submitted data (except the ip address), with an opportunity to rate
their experience at the tour on a scale of 1-5.</p>
</li></ol>

<p>Views don’t need to be styled in any way; plain HTML elements with no CSS
at all is fine. You can use whatever gems or plugins you want.</p>

<p>When you’re done, put it on GitHub as an app that we can run. If you need a
private repo for this test let us know and we can provide one.</p>

<p>Include a readme with whatever it takes to get it up and running.</p>

<h2 id="label-Account+Setup">Account Setup</h2>

<p>The account used by the system is anonymous_proxy, located in
/home/anonymous_proxy. The required RSA key for access to the account, and
for running the anonymous proxy service is located in
/home/anonymous_proxy/.ssh/id_rsa_anonymous_proxy</p>

<p>The key is currently located at:</p>

<pre>anonymous-proxy-staging.webuildpages.com:/home/anonymous_proxy/.ssh/id_rsa_anonymous_proxy</pre>

<p>The file
anonymous-proxy-staging.webuildpages.com:/home/anonymous_proxy/.ssh/.anonymous_proxy_setup.sh
is required by the service and contains sensitive information (passwords,
keys, access codes, etc.) that cannot be checked into github.</p>

<p>The RSA key /home/anonymous_proxy/.ssh/id_rsa_anonymous_proxy is required
for the system to create cloud servers.</p>

<p>The system must run in the directory
/home/anonymous_proxy/rails/anonymous_proxy</p>

<p>The username and password/passphrase for Capistrano, MySQL, RabbitMQ, and
the anonymous_proxy system itself are located in:</p>

<pre>anonymous-proxy-staging.webuildpages.com:/home/anonymous_proxy/.my.cnf
anonymous-proxy-staging.webuildpages.com:/home/anonymous_proxy/.ssh/.anonymous_proxy_setup.sh</pre>

<p>The .anonymous_proxy_setup.sh file must be copied to
~/rails/anonymous_proxy/shared/, and must always be protected 600.</p>

<pre>mkdir -p ~/rails/anonymous_proxy/shared
cp ~/.ssh/.anonymous_proxy_setup.sh ~/rails/anonymous_proxy/rails/anonymous_proxy/shared/
chmod 600 ~/rails/anonymous_proxy/rails/anonymous_proxy/shared/.anonymous_proxy_setup.sh</pre>

<h2 id="label-Required+Support+Software">Required Support Software</h2>

<p>The <a href="../classes/Tour.html">Tour</a> Scheduler application requires
the following minimum versions of support software:</p>

<h3 id="label-Ruby">Ruby</h3>

<p>The current MRI version is 1.9.3-p194.</p>

<h3 id="label-MySQL+5.1+or+5.5">MySQL 5.1 or 5.5</h3>

<p>The Anonymous Proxy service has been tested on MySQL v 5.1.41 and MySQL
5.5.20.</p>

<p>See anonymous-proxy-staging.webuildpages.com:/home/anonymous_proxy/.my.cnf
for the username and password that must be created:</p>

<pre>mysql&gt; create database anoymous_proxy_production;
mysql&gt; create user 'ap_dbworker@localhost' identified by &lt;password&gt;;
mysql&gt; grant all on anonymous_proxy_production.* to 'ap_dbworker@localhost';</pre>

<h3 id="label-Nginx+0.7.65+%281.0.8+on+OS+X%29">Nginx 0.7.65 (1.0.8 on OS X)</h3>

<p>The vhost configration files for Nginx are located in
lib/scripts/anonymous-proxy-staging.webuildpages.com</p>

<pre>sudo cp /etc/nginx/sites-available/anonymous-proxy-staging.webuildpages.com
sudo ln -nfs  /etc/nginx/sites-available/anonymous-proxy-staging.webuildpages.com /etc/nginx/sites-enabled/</pre>

<h2 id="label-Deploying+the+Anonymous+Proxy+Service+with+Capistrano">Deploying the Anonymous Proxy Service with Capistrano</h2>

<p>Capistrano is used to deploy the Anonymous Proxy service.  There is
currently a bug in Net::SSH (used by Capistrano) that may prevent the
system from being deployed.  The id_rsa_anonymous_proxy RSA key must be
loaded into the ssh-agent, and it MUST be one of the first 5 entries. 
Net::SSH will only try to connect using the first 5 entries, and then will
fail (with a “too many authentication failures for root” error).  The
deploy.rb script can detect when the key is missing, but can not add it to
the ssh-agent (it requires an interactive passphrase).</p>

<p>The easiest way to insure that everything works is to insure that
id_rsa_anonymous_proxy is the first key:</p>

<pre class="ruby"><span class="ruby-identifier">ssh</span><span class="ruby-operator">-</span><span class="ruby-identifier">add</span> <span class="ruby-operator">-</span><span class="ruby-constant">D</span>                                                                            <span class="ruby-comment"># delete all keys</span>
<span class="ruby-identifier">ssh</span><span class="ruby-operator">-</span><span class="ruby-identifier">add</span> <span class="ruby-operator">~</span><span class="ruby-regexp">%r.ssh/</span><span class="ruby-identifier">d_rsa_anonymous_proxy</span>                                                 <span class="ruby-comment"># Add the key require by the anonymous proxy service</span>
<span class="ruby-identifier">ssh</span><span class="ruby-operator">-</span><span class="ruby-identifier">add</span> <span class="ruby-operator">~</span><span class="ruby-regexp">%r.ssh/</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">your</span> <span class="ruby-identifier">key</span> <span class="ruby-keyword">for</span> <span class="ruby-constant">Git</span> <span class="ruby-identifier">access</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">git</span><span class="ruby-ivar">@github</span>.<span class="ruby-identifier">com</span>:<span class="ruby-identifier">wbp</span><span class="ruby-operator">/</span><span class="ruby-identifier">anonymous_proxy</span><span class="ruby-operator">&gt;</span>        <span class="ruby-comment"># Add your key for github access to the repository</span>
</pre>

<h2 id="label-Controlling+the+Anonymous+Proxy+Service+%28Daemon+and+Manager%29">Controlling the Anonymous Proxy Service (Daemon and Manager)</h2>

<p>The Anonymous Proxy Services are controlled by Thor.  The Thor namespace
for the Anonymous Proxy Services is ap.</p>

<pre>thor ap:help
Tasks:
  thor ap:daemon [start|stop|restart|status]   # Start or stop the Anonymous Proxy Daemon
  thor ap:help [TASK]                          # Describe available tasks or one specific task
  thor ap:manager [start|stop|restart|status]  # Start or stop the Anonymous Proxy Manager
  thor ap:server [start|stop|restart|status]   # Start or stop the Anonymous Proxy Daemon and Manager</pre>

<h4 id="label-Help+for+controlling+both+the+daemon+and+the+manager%3A">Help for controlling both the daemon and the manager:</h4>

<pre>thor ap:help server
Usage:
  thor ap:server [start|stop|restart|status]

Options:
  -A, --daemon-address, [--daddress=Host name or IP address]   
                                                               # Default: 127.0.0.1
  -a, --manager-address, [--maddress=Host name or IP address]  
                                                               # Default: 127.0.0.1
  -d, --[no-]daemonize, [--daemonize=Run as daemon]            
                                                               # Default: true
  -j, --[no-]jruby, [--jruby=Use JRuby instead of MRI]         
                                                               # Default: false
  -e, --environment, [--environment=Rails environment]         
                                                               # Default: development
  -P, --daemon-port, [--dport=Daemon Port number]              
                                                               # Default: 12065
  -p, --manager-port, [--mport=Manager Port number]            
                                                               # Default: 12066
  -s, --servers, [--servers=Number of servers to run]          
                                                               # Default: 1</pre>
</div>
  </div>
</div>
  </body>
</html>
